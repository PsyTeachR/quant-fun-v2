<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 4 Data wrangling 1 | Fundamentals of Quantitative Analysis</title>
<meta name="author" content="Emily Nordmann &amp; Phil McAleer">
<meta name="description" content="So far we having been starting to get our head around data and storing them in objects but as you will learn, data comes in lots of different formats. One of the most common formats is that of a...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="Chapter 4 Data wrangling 1 | Fundamentals of Quantitative Analysis">
<meta property="og:type" content="book">
<meta property="og:url" content="https://psyteachr.github.io/quant-fun-v2/data-wrangling-1.html">
<meta property="og:image" content="https://psyteachr.github.io/quant-fun-v2/images/logos/logo.png">
<meta property="og:description" content="So far we having been starting to get our head around data and storing them in objects but as you will learn, data comes in lots of different formats. One of the most common formats is that of a...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 4 Data wrangling 1 | Fundamentals of Quantitative Analysis">
<meta name="twitter:description" content="So far we having been starting to get our head around data and storing them in objects but as you will learn, data comes in lots of different formats. One of the most common formats is that of a...">
<meta name="twitter:image" content="https://psyteachr.github.io/quant-fun-v2/images/logos/logo.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.11/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-6NP3MF25W3"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-6NP3MF25W3');
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="include/psyteachr.css">
<link rel="stylesheet" href="include/webex.css">
<link rel="stylesheet" href="include/style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Fundamentals of Quantitative Analysis</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Overview</a></li>
<li><a class="" href="foreword.html">Foreword</a></li>
<li><a class="" href="programming-basics.html"><span class="header-section-number">1</span> Programming basics</a></li>
<li><a class="" href="intro-to-r.html"><span class="header-section-number">2</span> Intro to R</a></li>
<li><a class="" href="starting-with-data.html"><span class="header-section-number">3</span> Starting with data</a></li>
<li><a class="active" href="data-wrangling-1.html"><span class="header-section-number">4</span> Data wrangling 1</a></li>
<li><a class="" href="data-wrangling-2.html"><span class="header-section-number">5</span> Data wrangling 2</a></li>
<li><a class="" href="data-wrangling-3.html"><span class="header-section-number">6</span> Data Wrangling 3</a></li>
<li><a class="" href="intro-to-data-visualisation.html"><span class="header-section-number">7</span> Intro to Data Visualisation</a></li>
<li><a class="" href="probability.html"><span class="header-section-number">8</span> Probability</a></li>
<li><a class="" href="correlations.html"><span class="header-section-number">9</span> Correlations</a></li>
<li><a class="" href="t-tests.html"><span class="header-section-number">10</span> t-tests</a></li>
<li><a class="" href="power-and-effect-sizes.html"><span class="header-section-number">11</span> Power and Effect Sizes</a></li>
<li><a class="" href="screening-data.html"><span class="header-section-number">12</span> Screening Data</a></li>
<li><a class="" href="visualisation.html"><span class="header-section-number">13</span> Visualisation</a></li>
<li><a class="" href="one-way-anova.html"><span class="header-section-number">14</span> One-way ANOVA</a></li>
<li><a class="" href="factorial-anova.html"><span class="header-section-number">15</span> Factorial ANOVA</a></li>
<li><a class="" href="regression.html"><span class="header-section-number">16</span> Regression</a></li>
<li><a class="" href="multiple-regression.html"><span class="header-section-number">17</span> Multiple regression</a></li>
<li class="book-part">Appendices</li>
<li><a class="" href="installing-r.html"><span class="header-section-number">A</span> Installing R</a></li>
<li><a class="" href="updating-packages.html"><span class="header-section-number">B</span> Updating packages</a></li>
<li><a class="" href="additional-resources.html"><span class="header-section-number">C</span> Additional Resources</a></li>
<li><a class="" href="citing-r-rstudio.html"><span class="header-section-number">D</span> Citing R and RStudio</a></li>
<li><a class="" href="symbols.html"><span class="header-section-number">E</span> Symbols</a></li>
<li><a class="" href="conventions.html"><span class="header-section-number">F</span> Conventions</a></li>
<li><a class="" href="license.html">License</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/PsyTeachR/quant-fun-v2">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="data-wrangling-1" class="section level1" number="4">
<h1>
<span class="header-section-number">4</span> Data wrangling 1<a class="anchor" aria-label="anchor" href="#data-wrangling-1"><i class="fas fa-link"></i></a>
</h1>
<p>So far we having been starting to get our head around data and storing them in <a class="glossary" target="_blank" title="A word that identifies and stores the value of some data for later use." href="https://psyteachr.github.io/glossary/o#object">objects</a> but as you will learn, data comes in lots of different formats. One of the most common formats is that of a <a class="glossary" target="_blank" title="Data in a rectangular table format, where each row has an entry for each column." href="https://psyteachr.github.io/glossary/t#tabular-data">two-dimensional table</a> (the two dimensions being rows and columns). Usually, each row stands for a separate <a class="glossary" target="_blank" title="A word that identifies and stores the value of some data for later use." href="https://psyteachr.github.io/glossary/o#object">object</a> (e.g. a subject), and each column stands for a different variable (e.g. a response, category, or group). A key benefit of tabular data is that it allows you to store different <a class="glossary" target="_blank" title="The kind of data represented by an object." href="https://psyteachr.github.io/glossary/d#data-type">types of data</a>, e.g. numerical measurements, alphanumeric labels, categorical descriptors, etc, all in one place.</p>
<p>One of the core skills you will learn when working with data is <a class="glossary" target="_blank" title="The process of preparing data for visualisation and statistical analysis." href="https://psyteachr.github.io/glossary/d#data-wrangling">data wrangling</a>. This means completing tasks such as determining <a class="glossary" target="_blank" title="A data point that is extremely distant from most of the other data points" href="https://psyteachr.github.io/glossary/o#outlier">outliers</a>, clearing up erroneous values, changing the structure of tables, merging information stored in separate tables, reducing the data down to a subset of observations, and producing data summaries. It may surprise you to learn that researchers actually spend far more of time cleaning and preparing their data than they spend actually analysing it. Some have estimated that up to 80% of time spent on data analysis involves such data preparation tasks <span class="citation">(<a href="references.html#ref-dasu2003" role="doc-biblioref">Dasu &amp; Johnson, 2003</a>)</span>!</p>
<p>When you ask people about data wrangling, many people seem to operate under the assumption that the only approach is the painstaking and time-consuming cutting and pasting of data within a proprietary spreadsheet programs like Excel. Indeed, many may waste days, weeks, and even months manually transforming their data through the laborious cutting, copying, and pasting of data. Wrangling your data manually, by hand, however is not only a terrible use of your time, but it is error-prone and not <a class="glossary" target="_blank" title="Research that documents all of the steps between raw data and results in a way that can be verified." href="https://psyteachr.github.io/glossary/r#reproducible-research">reproducible</a>. Additionally, in this day and age where we can easily collect massive datasets online, it is just not conceivable to organise, clean, and prepare this data by hand, and so the alternative and reproducible approach you have begun to learn is highly beneficial.</p>
<p>In short, being able to perform some key data wrangling skills will allow you the opportunity to thrive, not only as a psychologist but in any of the numerous roles that require handling data. You see the truth is that although every dataset presents unique challenges, there are some systematic principles you should follow that will make your analyses easier, less error-prone, more efficient, and more reproducible.Putting that another way, the data changes but the skills stay the same!</p>
<p>So now let's get into learning some new skills. In this lesson you will see how data wrangling skills will allow you to efficiently get answers to nearly any question you might want to ask about your data. By learning how to properly make your computer do the hard and boring work for you, you can focus on the bigger issues.</p>
<div id="tidyverse" class="section level2" number="4.1">
<h2>
<span class="header-section-number">4.1</span> Tidyverse<a class="anchor" aria-label="anchor" href="#tidyverse"><i class="fas fa-link"></i></a>
</h2>
<p>In the first chapter we introduced a <a class="glossary" target="_blank" title="A group of R functions." href="https://psyteachr.github.io/glossary/p#package">package</a> called <code>tidyverse</code> and it is going to be at the core of a lot of the data skills you develop. The <code>tidyverse</code> <a href="https://www.tidyverse.org/" target="_blank">https://www.tidyverse.org/</a> <span class="citation">(<a href="references.html#ref-tidyverse" role="doc-biblioref">Wickham, 2017</a>)</span> is actually a collection of packages developed by a team led by the world-famous data scientist Hadley Wickham. Those core packages contained within <code>tidyverse</code> are <code>dplyr</code>, <code>tidyr</code>, <code>readr</code>, <code>purrr</code>, <code>ggplot2</code>, and <code>tibble</code>, and within these six core packages you will have access to <a class="glossary" target="_blank" title="A named section of code that can be reused." href="https://psyteachr.github.io/glossary/f#function">functions</a> that will pretty much cover everything you need in order to be able to wrangle and visualise your data.. Again, don't worry about trying to remember all the different packages and what they all do, that will come with practice. The main thing to note however is that previously when you typed <code><a href="https://tidyverse.tidyverse.org">library(tidyverse)</a></code> into your code, you will have seen that it loads in all of these packages in one go. You will learn how to use a whole host of functions from the <code>tidyverse</code> as we progress, but in this chapter we are going to focus on functions from the <code>dplyr</code> package, mainly for data wrangling, and <code>ggplot2</code> for visualisation (i.e. creating images and figures).</p>
<p>Looking at the <code>dplyr</code> package specifically, it contains six very important functions based on common English verbs to help readability of the code. These six verbs are often referred to as the Wickham Six "one-table" dplyr verbs as they perform actions on a single table of data. Those six functions are:</p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="center">Function</th>
<th align="left">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center"><code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code></td>
<td align="left">Include or exclude certain variables (columns)</td>
</tr>
<tr class="even">
<td align="center"><code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code></td>
<td align="left">Include or exclude certain observations (rows)</td>
</tr>
<tr class="odd">
<td align="center"><code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code></td>
<td align="left">Create new variables (columns)</td>
</tr>
<tr class="even">
<td align="center"><code><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange()</a></code></td>
<td align="left">Change the order of observations (rows)</td>
</tr>
<tr class="odd">
<td align="center"><code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code></td>
<td align="left">Organize the observations (rows) into groups</td>
</tr>
<tr class="even">
<td align="center"><code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code></td>
<td align="left">Create summary variables for groups of observations</td>
</tr>
</tbody>
</table></div>
<p>Just looking at the names gives you some idea of what the functions do. For example, <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code>, which we saw previously, selects columns! But don't be fooled, although the operations of these functions may seem very simplistic, it’s amazing what you can accomplish when you string them together. Hadley Wickham, in fact, has claimed that 90% of data analysis can be reduced to the operations described by these six functions. You are going to use the functions but we will introduce them today just to show what they can do.</p>
</div>
<div id="intro-to-the-babynames-database" class="section level2" number="4.2">
<h2>
<span class="header-section-number">4.2</span> Intro to the <code>babynames</code> database<a class="anchor" aria-label="anchor" href="#intro-to-the-babynames-database"><i class="fas fa-link"></i></a>
</h2>
<p>To demonstrate the power of the six <code>dplyr</code> verbs we will use them to work with data from the <code>babynames</code> package. The babynames dataset has historical information about the births of babies in the U.S. from 1880 to the present day and is a nice understandable dataset that will allow us to us just focus on getting to know the functions across a series of activities, beginning now!</p>
<div id="dw1-a1" class="section level3" number="4.2.1">
<h3>
<span class="header-section-number">4.2.1</span> Activity 1: Set-up<a class="anchor" aria-label="anchor" href="#dw1-a1"><i class="fas fa-link"></i></a>
</h3>
<p>Complete the following series of steps. If you are unsure, try consulting the previous two chapters, keeping in mind that this is something we have done before!</p>
<ol style="list-style-type: decimal">
<li>Open RStudio and set the working directory to your chapter folder. Ensure the environment is clear.
<ol style="list-style-type: lower-roman">
<li>If you are working on the Rserver, avoid a number of issues by restarting the session - top menu: <strong><code>Session &gt;&gt; Restart R</code></strong>
</li>
</ol>
</li>
<li>Open a new R Markdown document and save it in your working directory. Call the file "DataWrangling1.Rmd".<br>
</li>
<li>If you are working <strong>on your own computer</strong>, install the package <code>babynames</code> using the <code><a href="https://rdrr.io/r/utils/install.packages.html">install.packages()</a></code> function - you will need quotation marks around the package name. <strong>Remember, never install packages if you are working on a university computer or on the Rserver</strong>.</li>
<li>Delete the default R Markdown default text (i.e. everything from line 12 down) and insert a new code <a class="glossary" target="_blank" title="A section of code in an R Markdown file" href="https://psyteachr.github.io/glossary/c#chunk">code chunk</a> that loads the packages <code>babynames</code> and <code>tidyverse</code> using <code><a href="https://rdrr.io/r/base/library.html">library()</a></code> function and run this code chunk.
<ol style="list-style-type: lower-roman">
<li>Note that the order of packages is deliberate!</li>
</ol>
</li>
</ol>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hadley/babynames">babynames</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></code></pre></div>
<div class="info">
<p>
<strong>On the order of libraries</strong>
</p>
<p>
In the first chapter you will recall we mentioned the issue of conflicts - the situation where two packages loaded into the library have functions with the same name but different approaches or jobs. The default approach that R takes in this situation is to "mask" the function from the library that was loaded in first. That means that it will use the function from the library loaded in most recently. As <code>tidyverse</code> contains the functions that you will use most of the time, the safest approach is to always load in the <code>tidyverse</code> last, regardless of the other packages you are loading in. In truth, as with everything in life, there is an additional complication involved that sometimes arises but for now taking the approach of running <code><a href="https://tidyverse.tidyverse.org">library(tidyverse)</a></code> last is going to save a lot of issues.
</p>
</div>
</div>
<div id="dw1-a2" class="section level3" number="4.2.2">
<h3>
<span class="header-section-number">4.2.2</span> Activity 2: Look at the data<a class="anchor" aria-label="anchor" href="#dw1-a2"><i class="fas fa-link"></i></a>
</h3>
<p>Great! Now that we have our packages loaded in let's look at our data. The package <code>babynames</code> is a bit unique in that it contains an object of the same name, <code>babynames</code>, that contains all the data about, well, baby names, and we can look at that object to get a sense of our data.</p>
<ul>
<li>Have a look at your data by typing the word <code>babynames</code> into your <a class="glossary" target="_blank" title="The pane in RStudio where you can type in commands and view output messages." href="https://psyteachr.github.io/glossary/c#console">console</a> window and running it.</li>
</ul>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">babynames</span></code></pre></div>
<p>You should see something like the following output:</p>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="right">year</th>
<th align="left">sex</th>
<th align="left">name</th>
<th align="right">n</th>
<th align="right">prop</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1880</td>
<td align="left">F</td>
<td align="left">Mary</td>
<td align="right">7065</td>
<td align="right">0.0723836</td>
</tr>
<tr class="even">
<td align="right">1880</td>
<td align="left">F</td>
<td align="left">Anna</td>
<td align="right">2604</td>
<td align="right">0.0266790</td>
</tr>
<tr class="odd">
<td align="right">1880</td>
<td align="left">F</td>
<td align="left">Emma</td>
<td align="right">2003</td>
<td align="right">0.0205215</td>
</tr>
<tr class="even">
<td align="right">1880</td>
<td align="left">F</td>
<td align="left">Elizabeth</td>
<td align="right">1939</td>
<td align="right">0.0198658</td>
</tr>
<tr class="odd">
<td align="right">1880</td>
<td align="left">F</td>
<td align="left">Minnie</td>
<td align="right">1746</td>
<td align="right">0.0178884</td>
</tr>
<tr class="even">
<td align="right">1880</td>
<td align="left">F</td>
<td align="left">Margaret</td>
<td align="right">1578</td>
<td align="right">0.0161672</td>
</tr>
</tbody>
</table></div>
</div>
<p>The first line tells us "# A tibble: 1924665 x 5". What this means is that the object we are looking at is actually a <a class="glossary" target="_blank" title="A container for tabular data with some different properties to a data frame" href="https://psyteachr.github.io/glossary/t#tibble">tibble</a>, a type of two dimensional table with some unique properties, and we have data across 1924665 variables (columns) with 1924665 million observations (rows). Yes, this dataset contains over 1.9 <strong>million</strong> observations. Interested in analyzing these data by hand? No thanks!</p>
<p>Looking at the column names you start to get a sense of what the data is. The variables (columns) are as follows:</p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th>variable</th>
<th>type</th>
<th>description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>year</td>
<td>double (numeric)</td>
<td>year of birth</td>
</tr>
<tr class="even">
<td>sex</td>
<td>character</td>
<td>recorded sex of baby (F = female, M = male)</td>
</tr>
<tr class="odd">
<td>name</td>
<td>character</td>
<td>forename given to baby</td>
</tr>
<tr class="even">
<td>n</td>
<td>integer</td>
<td>number of babies given that name</td>
</tr>
<tr class="odd">
<td>prop</td>
<td>double (numeric)</td>
<td>proportion of all babies of that sex</td>
</tr>
</tbody>
</table></div>
<p>As such, each row represents data about births for a given name and sex in a given year. For example, the first row of the data tells us that in the year 1880, there were 7065 baby girls (F) born in the U.S.A who were given the name Mary, and this accounted for 7.238359% of all baby girls that year.</p>
</div>
<div id="dw1-a3" class="section level3" number="4.2.3">
<h3>
<span class="header-section-number">4.2.3</span> Activity 3: Your first plot<a class="anchor" aria-label="anchor" href="#dw1-a3"><i class="fas fa-link"></i></a>
</h3>
<p>Brilliant! Now we know what our data looks like in terms of the table - or really the <code>tibble</code> - let's show you a quick code to help visualise some of this data.</p>
<ul>
<li>In a new code chunk in your R Markdwon file, type the code below and run it.</li>
</ul>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">babynames</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">name</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Emily"</span>,
                     <span class="st">"Kathleen"</span>,
                     <span class="st">"Alexandra"</span>,
                     <span class="st">"Beverly"</span><span class="op">)</span>, <span class="va">sex</span><span class="op">==</span><span class="st">"F"</span><span class="op">)</span>

<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">dat</span>,
       <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>,
           y <span class="op">=</span> <span class="va">prop</span>, 
           colour <span class="op">=</span> <span class="va">name</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span>  </code></pre></div>
<p>And you should see this output:</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:babynames-plot-real"></span>
<img src="04-wrangling-1_files/figure-html/babynames-plot-real-1.png" alt="Proportion of four baby names from 1880 to 2014" width="100%"><p class="caption">
Figure 4.1: Proportion of four baby names from 1880 to 2014
</p>
</div>
<p>Now we know that the code right now will not make much sense to you but don't worry about that as we don't expect you to fully understand the code just yet. The point is really to show you how much you can accomplish with very little code. The code creates a figure (Figure <a href="data-wrangling-1.html#fig:babynames-plot-real">4.1</a>) showing the popularity of four girl baby names - Alexandra, Beverly, Emily, and Kathleen - from 1880 to 2014. Popularity here is expressed in proportion (y-axis) in different years (x-axis). As you will come to learn, <code>ggplot()</code> is the main visualisation function, and <code>geom_line()</code> creates a linegraph.</p>
<ul>
<li>Now change the names in your code chunk to some female names you like and run the code to see how the Figure changes.</li>
<li>Now change the names in your code chunk to some male names and change the sex from “F” to “M”. Run the code and see what happens. Post the photos of your new plots on the Teams channel.</li>
<li>Now change the code to what you want to display and post an image of your favorite figure that you have created on the TEAMS channel and get some praise from the TEAM!</li>
</ul>
<div class="webex-solution">
<button>
But I want to display male AND female names!
</button>
<p>This is more complicated than you might first imagine so only read on if you're feeling confident. If you remove the filter for <code>sex</code> when creating <code>dat</code> and then run the plot code again, it will make a very messy looking plot (try it). This is because for most names there will be two data points because although the numbers might be small for gendered names, there is usually always at least one baby of the non-dominant name gender that has been assigned that name.</p>
<p>You can get around this by adding an additional line of code that produces separate plots by sex. See here:</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dat2</span> <span class="op">&lt;-</span> <span class="va">babynames</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">name</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Emily"</span>,<span class="st">"Kathleen"</span>,<span class="st">"Alexandra"</span>,<span class="st">"Beverly"</span><span class="op">)</span><span class="op">)</span>

<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">dat2</span>,<span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>,y <span class="op">=</span> <span class="va">prop</span>, colour<span class="op">=</span><span class="va">name</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">sex</span>, scales <span class="op">=</span> <span class="st">"free_y"</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:chpt4-hid1"></span>
<img src="04-wrangling-1_files/figure-html/chpt4-hid1-1.png" alt="Plots by sex with different scales" width="100%"><p class="caption">
Figure 4.2: Plots by sex with different scales
</p>
</div>
<p>The <code>facet_wrap()</code> function is one that can split up figures based on a given variable - in this case <code>sex</code>, meaning give me a plot for all the different sex categories we have. The <code>scales</code> argument tells the code that it can use different scales on the y-axis for each plot - when there's a large difference between the two scales this is helpful to allow you to see the data in both sets (run this code and then remove the scales argument and run it again to see the difference) although it does run the risk of people misinterpreting the data if the difference between the scales isn't made clear.</p>
<p>On the other hand, if the scales for your two groups are fairly similar, it's better to keep the same scales to aid comparison. This time we will filter the dataset for gender neutral names where it might make more sense to have them on the same scale - again try it with and without the scales argument to see what happens</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dat3</span> <span class="op">&lt;-</span> <span class="va">babynames</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">name</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Sam"</span>,<span class="st">"Alex"</span>,<span class="st">"Jordan"</span>,<span class="st">"Drew"</span><span class="op">)</span><span class="op">)</span>

<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">dat3</span>,<span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>,y <span class="op">=</span> <span class="va">prop</span>, colour<span class="op">=</span><span class="va">name</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">sex</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:chpt4-show1"></span>
<img src="04-wrangling-1_files/figure-html/chpt4-show1-1.png" alt="Plots by sex with the same scale" width="100%"><p class="caption">
Figure 4.3: Plots by sex with the same scale
</p>
</div>
</div>
<p>As a side point, because in most countries assigned sex at birth is binary, there is no data on intersex, trans or non-binary names. In lieu of that, here’s the <a href="https://en.wikipedia.org/wiki/Unisex_name" target="_blank">Wikipedia page</a> about gender-neutral names and naming laws around the world which will hopefully make you question why we ascribe someone’s entire gender identity to a bunch of sounds and letters we use to label them.</p>
</div>
</div>
<div id="six-functions-for-wrangling-the-babynames" class="section level2" number="4.3">
<h2>
<span class="header-section-number">4.3</span> Six functions for wrangling the <code>babynames</code><a class="anchor" aria-label="anchor" href="#six-functions-for-wrangling-the-babynames"><i class="fas fa-link"></i></a>
</h2>
<p>Ok so now we have a fairly code understanding of the babynames, let's use it to learn a bit more about the six functions from <code>dplyr</code> that make up a lot of data wrangling!</p>
<div id="dw1-a4" class="section level3" number="4.3.1">
<h3>
<span class="header-section-number">4.3.1</span> Activity 4: Selecting variables of interest with <code>select()</code><a class="anchor" aria-label="anchor" href="#dw1-a4"><i class="fas fa-link"></i></a>
</h3>
<p>Often data has a lot of variables we don't need and it can be easier to focus on just the data we do need. In <code>babynames</code> there are two numeric measurements of name popularity - <code>prop</code>, the proportion of all babies with each name, is probably more useful than <code>n</code>, the total number of babies with that name, because <code>prop</code> takes into account that different numbers of babies are born in different years.</p>
<p>Now as we saw previously, if we wanted to create a dataset that only includes certain variables, we can use the <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> function from the <code>dplyr</code> package.</p>
<ul>
<li>In a new code chunk, type and run the below code to select only the columns <code>year</code>, <code>sex</code>, <code>name</code> and <code>prop</code> and store it as a <code>tibble</code> in the object named <code>babynames_reduced</code>.
<ul>
<li>the first argument <code>.data</code> is the object we want to select variables from, in this case <code>babynames</code>
</li>
<li>the additional arguments are the names of the variables you want to <strong>keep</strong>!</li>
</ul>
</li>
</ul>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">babynames_reduced1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span>.data <span class="op">=</span> <span class="va">babynames</span>,
                            <span class="va">year</span>, 
                            <span class="va">sex</span>, 
                            <span class="va">name</span>, 
                            <span class="va">prop</span><span class="op">)</span></code></pre></div>
<p>Alternatively, you can also state which variables you don't want to keep! This is really handy if you want to keep a lot of columns and only get rid of maybe one or two.</p>
<ul>
<li>Type and run in the below code in a new code chunk.
<ul>
<li>Here, rather than stating you want to keep <code>year</code>, <code>sex</code>, <code>name</code> and <code>prop</code>, we can say drop (i.e. get rid of) the column <code>n</code> using the minus sign <code><a href="https://rdrr.io/r/base/Arithmetic.html">-</a></code> before the variable name.</li>
</ul>
</li>
</ul>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">babynames_reduced2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span>.data <span class="op">=</span> <span class="va">babynames</span>, 
                             <span class="op">-</span><span class="va">n</span><span class="op">)</span></code></pre></div>
<p><strong>Note</strong> that <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> does not change the original tibble, <code>babynames</code>, but makes a new object that stores a new tibble with the specified columns, i.e. <code>babynames_reduced1</code> and <code>babynames_reduced2</code>. You will see the new objects in your environment pane. If you don't save the new tibbles to an object, they won't be saved. For example, the below code does the same as the previous code but is not saved as the output of the function is not assigned (using the <a class="glossary" target="_blank" title="The symbol &lt;-, which functions like = and assigns the value on the right to the object on the left" href="https://psyteachr.github.io/glossary/a#assignment-operator">assignment operator</a>, <code><a href="https://rdrr.io/r/base/assignOps.html">&lt;-</a></code>) to a new object.</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span>.data <span class="op">=</span> <span class="va">babynames</span>, 
       <span class="op">-</span><span class="va">n</span><span class="op">)</span></code></pre></div>
</div>
<div id="dw1-a5" class="section level3" number="4.3.2">
<h3>
<span class="header-section-number">4.3.2</span> Activity 5: Arranging the data with <code>arrange()</code><a class="anchor" aria-label="anchor" href="#dw1-a5"><i class="fas fa-link"></i></a>
</h3>
<p>Superb! We now know how to select variables. Another handy skill is being able to change the order of data in a tibble. The function <code><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange()</a></code> will sort the rows in the table according to the columns you supply.</p>
<ul>
<li>Type and run the below code in a new code chunk.
<ul>
<li>the first argument <code>.data</code> again says what object to work on</li>
<li>the second argument says what column to sort the data by - in this instance we are sorting by <code>name</code>
</li>
<li>the default sorting order is ascending!</li>
</ul>
</li>
</ul>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sort_asc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span>.data <span class="op">=</span> <span class="va">babynames</span>,
                    <span class="va">name</span><span class="op">)</span></code></pre></div>
<p>If you look in <code>sort_asc</code> the data are now sorted in ascending alphabetical order by name. But what if you want the data in descending order? Here we can wrap the name of the variable in the <code><a href="https://dplyr.tidyverse.org/reference/desc.html">desc()</a></code> function.</p>
<ul>
<li>Type and run the below code in a new code chunk. When you have run the code have a look at <code>sort_desc</code> and note that the data is now sorted by descending year!</li>
</ul>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sort_desc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">babynames</span>, 
                     <span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span> </code></pre></div>
<p>Finally, you can also sort by more than one column and a combination of ascending and descending columns. Have a look at th below code and then answer the question below:</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">babynames</span>, 
        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span>, 
        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">sex</span><span class="op">)</span>, 
        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">prop</span><span class="op">)</span><span class="op">)</span> </code></pre></div>
The above code will produce:
<div id="radio_TJBTHSRVCF" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_TJBTHSRVCF" value=""><span>the data sorted by descending year and sex but ascending prop</span></label><label><input type="radio" autocomplete="off" name="radio_TJBTHSRVCF" value=""><span>the data sorted by descending year and prop but ascending sex</span></label><label><input type="radio" autocomplete="off" name="radio_TJBTHSRVCF" value="answer"><span>the data sorted by descending year, sex and prop</span></label><label><input type="radio" autocomplete="off" name="radio_TJBTHSRVCF" value=""><span>the data sorted by ascending year, sex and prop</span></label>
</div>
<div class="webex-solution">
<button>
Explain this answer
</button>
<p>As all the columns stated are wrapped in the <code><a href="https://dplyr.tidyverse.org/reference/desc.html">desc()</a></code> function inside the <code><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange()</a></code> function then all columns will be sorted in descending fashion, sorting the year first, then the sex, then the prop. Note however that the output is not being stored at all in a new object so you would not be able to work on the data later without saving it in an object first!</p>
</div>
</div>
<div id="dw1-a6" class="section level3" number="4.3.3">
<h3>
<span class="header-section-number">4.3.3</span> Activity 6: Using <code>filter()</code> to choose observations<a class="anchor" aria-label="anchor" href="#dw1-a6"><i class="fas fa-link"></i></a>
</h3>
<p>We are doing well here! OK, so we have previously used <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> to keep certain variables (i.e. columns). However, frequently you will also want to keep only certain observations (i.e. rows) - for example, only babies born after 1999, only Female babies (as above), or only babies named "Mary". You do this using the verb <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code>. The <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> function is a bit more involved than the other verbs, and requires more detailed explanation, but this is because it is also extremely powerful.</p>
<p>Here is an example of filter() function in action. Take a few minutes to think about what it might do. Perhaps even run it in a new code chunk and look at the ouput!</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">filt1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span>.data <span class="op">=</span> <span class="va">babynames</span>, 
                <span class="va">year</span> <span class="op">&gt;</span> <span class="fl">2000</span><span class="op">)</span></code></pre></div>
<p>Had a think about it? We are going to tell you now so maybe write down your answer before reading on!</p>
<p>OK, let's see if you are correct. The first part of the code tells the function to use the object <code>babynames</code>. The second argument, <code>year &gt; 2000</code>, is what is known as a <strong>Boolean expression</strong>: an expression whose evaluation (or action) results in a value of either TRUE or FALSE. What <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> does here really is keep any observations (rows) for which the expression (<code>year &gt; 2000</code> - which reads as "year greater than 2000") evaluates as TRUE, and excludes (removes) any row for which the expression evaluates to FALSE. So in effect, behind the scenes, <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> goes through the entire set of 1.9+ million observations, row by row, checking the value of year for each row, keeping it if the value is greater than 2000, and rejecting it if it is less than 2000.</p>
<p>To see how a boolean expression works, consider the code below. First we create an object will all the values (let's pretend they are years) from 1996:2005.</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">years</span> <span class="op">&lt;-</span> <span class="fl">1996</span><span class="op">:</span><span class="fl">2005</span>
<span class="va">years</span></code></pre></div>
<pre><code>##  [1] 1996 1997 1998 1999 2000 2001 2002 2003 2004 2005</code></pre>
<p>Now we run the same boolean expression fomr above across this set of values:</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">years</span> <span class="op">&gt;</span> <span class="fl">2000</span></code></pre></div>
<pre><code>##  [1] FALSE FALSE FALSE FALSE FALSE  TRUE  TRUE  TRUE  TRUE  TRUE</code></pre>
<p>You can see that the expression <code>years &gt; 2000</code> returns a <strong>logical vector</strong> (a <a class="glossary" target="_blank" title="A type of data structure that collects values with the same data type, like T/F values, numbers, or strings." href="https://psyteachr.github.io/glossary/v#vector">vector</a> of TRUE and FALSE values), where each entry represents whether the expression (<code>year &gt; 2000</code>) is TRUE or FALSE for that an entry in <code>years</code>. For the first five <code>years</code> (1996 to 2000) the answer is FALSE as they are less than 2000, and for the last five <code>years</code> (2001 to 2005) it is TRUE. Note that 2000 returns as FALSE because 2000 is not greater than 2000; it would instead be equivalent to 2000.</p>
<p>Here are the most commonly used Boolean expressions.</p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th>Operator</th>
<th>Name</th>
<th>is TRUE if and only if</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>A &lt; B</td>
<td>less than</td>
<td>A is less than B</td>
</tr>
<tr class="even">
<td>A &lt;= B</td>
<td>less than or equal</td>
<td>A is less than or equal to B</td>
</tr>
<tr class="odd">
<td>A &gt; B</td>
<td>greater than</td>
<td>A is greater than B</td>
</tr>
<tr class="even">
<td>A &gt;= B</td>
<td>greater than or equal</td>
<td>A is greater than or equal to B</td>
</tr>
<tr class="odd">
<td>A == B</td>
<td>equivalence</td>
<td>A exactly equals B</td>
</tr>
<tr class="even">
<td>A != B</td>
<td>not equal</td>
<td>A does not exactly equal B</td>
</tr>
<tr class="odd">
<td>A %in% B</td>
<td>in</td>
<td>A is an element of vector B</td>
</tr>
</tbody>
</table></div>
<p>We will run through a few of these just to introduce them so you get the idea. We would suggest typing each one in a new code chunk and running them and looking at the output to get an idea of what it does.</p>
<p>First example is if you want only those observations for a specific name (e.g., Mary), you use the equivalence operator <code><a href="https://rdrr.io/r/base/Comparison.html">==</a></code>. Note that you use double equal signs, not a single equal sign.</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">only_Marys</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">babynames</span>, 
                     <span class="va">name</span> <span class="op">==</span> <span class="st">"Mary"</span><span class="op">)</span></code></pre></div>
<p>Alternatively, if you wanted all the names except Mary, you use the 'not equals' operator which is a single equals sign preceeded by an exclamation mark:</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">no_Marys</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">babynames</span>, 
                   <span class="va">name</span> <span class="op">!=</span> <span class="st">"Mary"</span><span class="op">)</span> </code></pre></div>
<p>Next, what if you wanted names from a defined set - e.g., names of British queens? Just like we did previously, you can use the <code><a href="https://rdrr.io/r/base/match.html">%in%</a></code> approach shown here.</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">queens</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">babynames</span>, 
                 <span class="va">name</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Mary"</span>,
                             <span class="st">"Elizabeth"</span>,
                             <span class="st">"Victoria"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>This gives you data for the names in the vector on the right hand side of <code><a href="https://rdrr.io/r/base/match.html">%in%</a></code>. Note that the names are all held together in the <code><a href="https://rdrr.io/r/base/c.html">c()</a></code> which we have seen before, and each name is surrounded by quotation marks and seperated by a comma.</p>
<p>Next, a bit like when we got rid of all Marys, you can always invert an expression to get its opposite - that is what the exclamation mark tends to do. So, for instance, if you instead wanted to get rid of all Marys, Elizabeths, and Victorias you would use the following:</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">no_queens</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">babynames</span>, 
                    <span class="op">!</span><span class="op">(</span><span class="va">name</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Mary"</span>,
                                  <span class="st">"Elizabeth"</span>,
                                  <span class="st">"Victoria"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Ok so that is a brief intro to filters but it is worth keeping in mind that you can include as many expressions as you like as additional arguments to <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> and it will only pull out the rows for which all of the expressions evaluate to TRUE. For instance, <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter(babynames, year &gt; 2000, prop &gt; .01)</a></code> will keep only the rows (observations) where the year is greater than 2000 and that represent greater than 1% of the names for a given sex; any observation where either expression is false will be excluded. This ability to string together criteria makes <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> a very powerful member of the Wickham Six. Referring back to this section will help with a lot of the answers to problems you face when wrangling data!</p>
</div>
<div id="dw1-a7" class="section level3" number="4.3.4">
<h3>
<span class="header-section-number">4.3.4</span> Activity 7: Creating new variables with <code>mutate()</code><a class="anchor" aria-label="anchor" href="#dw1-a7"><i class="fas fa-link"></i></a>
</h3>
<p>Doing really well! Only a little more to go we promise! OK so we have really learnt a lot about changing the data we have but sometimes we need to create a new variable that doesn’t exist in our dataset. For instance, we might want to figure out what decade a particular year belongs to in out babynames data and add that to our data! To create new variables, we use the function <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code>.</p>
<ul>
<li>Type and run the below code in a new code chunk.
<ul>
<li>Here, you are mutating a new column onto the data and storing it in the object <code>baby_decades</code>
</li>
<li>the first argument is the original data, <code>babynames</code>
</li>
<li>the second argument is the name of the new column <code>decade</code> followed by what you want in that column - the decade.</li>
<li>we are creating the decades using the code `floor(year/10)*10. This seems complicated but it says take the year and divide by 10, then get rid of the decimal places, and then multiply by 10. So for example, 1945/10 = 194.5, and if you get rid of the decimal places that becomes 194, and multiply it by 10 gives you 1940s!.</li>
</ul>
</li>
</ul>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">baby_decades</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>.data <span class="op">=</span> <span class="va">babynames</span>,
                  decade <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">floor</a></span><span class="op">(</span><span class="va">year</span><span class="op">/</span><span class="fl">10</span><span class="op">)</span> <span class="op">*</span><span class="fl">10</span><span class="op">)</span>
<span class="va">baby_decades</span></code></pre></div>
<p>The start of the data will look something like this with the new column called <code>decade</code> mutated on:</p>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="right">year</th>
<th align="left">sex</th>
<th align="left">name</th>
<th align="right">n</th>
<th align="right">prop</th>
<th align="right">decade</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1880</td>
<td align="left">F</td>
<td align="left">Mary</td>
<td align="right">7065</td>
<td align="right">0.0723836</td>
<td align="right">1880</td>
</tr>
<tr class="even">
<td align="right">1880</td>
<td align="left">F</td>
<td align="left">Anna</td>
<td align="right">2604</td>
<td align="right">0.0266790</td>
<td align="right">1880</td>
</tr>
<tr class="odd">
<td align="right">1880</td>
<td align="left">F</td>
<td align="left">Emma</td>
<td align="right">2003</td>
<td align="right">0.0205215</td>
<td align="right">1880</td>
</tr>
<tr class="even">
<td align="right">1880</td>
<td align="left">F</td>
<td align="left">Elizabeth</td>
<td align="right">1939</td>
<td align="right">0.0198658</td>
<td align="right">1880</td>
</tr>
<tr class="odd">
<td align="right">1880</td>
<td align="left">F</td>
<td align="left">Minnie</td>
<td align="right">1746</td>
<td align="right">0.0178884</td>
<td align="right">1880</td>
</tr>
<tr class="even">
<td align="right">1880</td>
<td align="left">F</td>
<td align="left">Margaret</td>
<td align="right">1578</td>
<td align="right">0.0161672</td>
<td align="right">1880</td>
</tr>
</tbody>
</table></div>
</div>
<p>But mutates can be much simpler like this example here. Have a look at the code and then answer the question below:</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">baby_where</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>.data <span class="op">=</span> <span class="va">babynames</span>,
                  country <span class="op">=</span> <span class="st">"USA"</span><span class="op">)</span></code></pre></div>
What will be stored in the object <code>baby_where</code>?
<div id="radio_UFLCRBXRCT" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_UFLCRBXRCT" value=""><span>a tibble with one column called country that contains the decade people were born</span></label><label><input type="radio" autocomplete="off" name="radio_UFLCRBXRCT" value="answer"><span>a tibble with all the original data and a new column called country stating USA</span></label><label><input type="radio" autocomplete="off" name="radio_UFLCRBXRCT" value=""><span>a tibble with all the original data and a new column stating usa</span></label><label><input type="radio" autocomplete="off" name="radio_UFLCRBXRCT" value=""><span>a tibble with all the original data arranged by the country USA</span></label>
</div>
<div class="webex-solution">
<button>
Explain this Answer
</button>
<p>This code will create a new object storing a tibble that has all the original data and a new column called country that states USA for each row. The <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> adds to what is already there unless you add a <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> or <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> to remove columns or rows. Note that one of the answers is wrong because it states usa in lowercase but the code states it in uppercase, i.e. USA. Remember to be specific.</p>
</div>
</div>
<div id="dw1-a8" class="section level3" number="4.3.5">
<h3>
<span class="header-section-number">4.3.5</span> Activity 8: Grouping and summarising<a class="anchor" aria-label="anchor" href="#dw1-a8"><i class="fas fa-link"></i></a>
</h3>
<p>Brilliant! You are learning so much about changing data and just one more important step to go. The goal of wrangling in quantitative analysis is to summarise your data somehow! Perhaps you want to calculate the mean or median, or a sum total of your data. You can perform all of these operations using the function <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code>.</p>
<p>First, let's use the object <code>dat</code> from above that just has the data for the four girls names, Alexandra, Beverly, Emily, and Kathleen. Type and run this code in a new code chunk if <code>dat</code> does not already exist in your environment pane:</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">babynames</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">name</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Emily"</span>,
                     <span class="st">"Kathleen"</span>,
                     <span class="st">"Alexandra"</span>,
                     <span class="st">"Beverly"</span><span class="op">)</span>, <span class="va">sex</span> <span class="op">==</span> <span class="st">"F"</span><span class="op">)</span></code></pre></div>
<p>Now to start off, we're going to calculate the total number of babies across all years that were given one of these four names.</p>
<ul>
<li>Type and run the below code in a new code chunk
<ul>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> is the function we use to create summaries of the data</li>
<li>as per usual the first argument is the object we want to use, in this case <code>dat</code>
</li>
<li>the second argument is the name of the summary column, in this case <code>total</code>, and the summary value we want to create, in this case the sum, using <code><a href="https://rdrr.io/r/base/sum.html">sum()</a></code>, of all the values in <code>n</code>.</li>
</ul>
</li>
</ul>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dat_sum</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>.data <span class="op">=</span> <span class="va">dat</span>,
                     total <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>A <strong>top tip</strong> when coding is to get in the habit of translating your code into full sentences to make it easier to figure out what's happening. You can read the above code as "run the function <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> using the data in the object <code>dat</code> to create a new variable named <code>total</code> that is the result of adding up all the numbers in the column <code>n</code> and store it in <code>dat_sum</code>". If you look in <code>dat_sum</code> you will see the below output:</p>
<p>Here we see we have a total of 2161374 babies with those four names in our dataset! We will learn more summary functions as we go along, but <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> becomes even more powerful when combined with the final <code>dplyr</code> function, <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code>. Quite often, you will want to produce your summary statistics broken down by groups, for examples, the scores of participants in different conditions, or the reading time for native and non-native speakers and that is what <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> helps us do.</p>
<p>There are two ways you can use <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code>. First, you can create a new, grouped object as such. Here we are saying use the <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> function to group the data in <code>dat</code> based on the categories in the variable <code>name</code>.</p>
<ul>
<li>Type and run this code in a new code chunk.</li>
</ul>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">group_dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span>.data <span class="op">=</span> <span class="va">dat</span>,
                      <span class="va">name</span><span class="op">)</span> </code></pre></div>
<p>If you look at this object in the viewer, it won't look any different to the original <code>dat</code>, however, the underlying structure has changed - you can see this by typing group_dat in the console window and running it. It says the number of groups in the secpnd line of the output - "# Groups: name [4]"</p>
<p>However, let's run the above summarise code again, but now using the new <code>group_dat</code> object and look at the output.</p>
<ul>
<li>Type and run the below code in a new code chunk</li>
</ul>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">group_sum</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>.data <span class="op">=</span> <span class="va">group_dat</span>, 
                       total <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span> </code></pre></div>
<p><code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> has performed exactly the same operation as before - adding up the total number in the column <code>n</code> - but this time it has done is separately for each group, which in this case was the variable <code>name</code> and gives an output that looks like this:</p>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">name</th>
<th align="right">total</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Alexandra</td>
<td align="right">231364</td>
</tr>
<tr class="even">
<td align="left">Beverly</td>
<td align="right">376914</td>
</tr>
<tr class="odd">
<td align="left">Emily</td>
<td align="right">841491</td>
</tr>
<tr class="even">
<td align="left">Kathleen</td>
<td align="right">711605</td>
</tr>
</tbody>
</table></div>
</div>
<div class="info">
<p>
If you get what looks like an error that says <code>summarise() ungrouping output (override with .groups argument)</code>don't worry, this isn't an error it's just R telling you what it's done to the groups that you have created and will become more obvious with more examples in later chapters.
</p>
</div>
<p>And two more final examples to show that you can request multiple summary calculations to be performed in the same function. For example, the following code calculates the mean and median number of babies given each name every year.</p>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sum_multi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span><span class="va">group_dat</span>,
                       mean_year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>,
                       median_year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>And you can also add multiple grouping variables. For example, the following code groups <code>baby_decades</code> by <code>sex</code> and <code>decade</code> and then calculates the summary statistics to give us the mean and median number of male and female babies in each decade.</p>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">group_decades</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">baby_decades</span>, 
                          <span class="va">sex</span>, 
                          <span class="va">decade</span><span class="op">)</span>

<span class="va">sum_decades</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span><span class="va">group_decades</span>,
                         mean_year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>,
                         median_year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>And again if you look at <code>sum_decades</code>, the first few lines would look something like this:</p>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">sex</th>
<th align="right">decade</th>
<th align="right">mean_year</th>
<th align="right">median_year</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">F</td>
<td align="right">1880</td>
<td align="right">110.5702</td>
<td align="right">13</td>
</tr>
<tr class="even">
<td align="left">F</td>
<td align="right">1890</td>
<td align="right">128.1841</td>
<td align="right">13</td>
</tr>
<tr class="odd">
<td align="left">F</td>
<td align="right">1900</td>
<td align="right">131.3290</td>
<td align="right">12</td>
</tr>
<tr class="even">
<td align="left">F</td>
<td align="right">1910</td>
<td align="right">187.0628</td>
<td align="right">12</td>
</tr>
<tr class="odd">
<td align="left">F</td>
<td align="right">1920</td>
<td align="right">210.5457</td>
<td align="right">12</td>
</tr>
<tr class="even">
<td align="left">F</td>
<td align="right">1930</td>
<td align="right">214.1987</td>
<td align="right">12</td>
</tr>
</tbody>
</table></div>
</div>
<p>Excellent! We have now had a run through of all of the Wickham six functions that allow us to arrange, select, filter, mutate, group by and summarise our data!</p>
</div>
</div>
<div id="dw1-a9" class="section level2" number="4.4">
<h2>
<span class="header-section-number">4.4</span> Introducing Pipes<a class="anchor" aria-label="anchor" href="#dw1-a9"><i class="fas fa-link"></i></a>
</h2>
<p>The final activity for this chapter essentially repeats what we've already covered but in a slightly different way. In the previous activities, you created new objects with new variables or groupings and then you called <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> on those new objects in separate lines of code. As a result, you had multiple objects in your environment pane and you need to make sure that you keep track of the different names.</p>
<p>Instead, you can use <a class="glossary" target="_blank" title="A way to order your code in a more readable format using the symbol %&gt;%" href="https://psyteachr.github.io/glossary/p#pipe">pipes</a>. Pipes are written as <code><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></code> and can be read as "and then". Pipes allow you to string together 'sentences' of code into 'paragraphs' so that you don't need to create intermediary objects. Really, this is something that is easier to show than tell.</p>
<p>The below code does very similar to all the code we wrote above but it only creates one object.</p>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pipe_summary</span> <span class="op">&lt;-</span> <span class="va">babynames</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>decade <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">floor</a></span><span class="op">(</span><span class="va">year</span><span class="op">/</span><span class="fl">10</span><span class="op">)</span> <span class="op">*</span><span class="fl">10</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">name</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Emily"</span>,
                     <span class="st">"Kathleen"</span>,
                     <span class="st">"Alexandra"</span>,
                     <span class="st">"Beverly"</span><span class="op">)</span>, <span class="va">sex</span><span class="op">==</span><span class="st">"F"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">name</span>, 
           <span class="va">decade</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>mean_decade <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by 'name'. You can override using the `.groups` argument.</code></pre>
<p>Again, just to note, you may see a warning when you run the above code regarding groups in the - this is similar to the previous time we saw the message and it is just letting you know what the output is grouped by. Nothing to worry about it basically. And if we then, as is good practice, look at the output from the above code, the first few lines would gives us:</p>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">name</th>
<th align="right">decade</th>
<th align="right">mean_decade</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Alexandra</td>
<td align="right">1890</td>
<td align="right">6.500000</td>
</tr>
<tr class="even">
<td align="left">Alexandra</td>
<td align="right">1900</td>
<td align="right">8.285714</td>
</tr>
<tr class="odd">
<td align="left">Alexandra</td>
<td align="right">1910</td>
<td align="right">32.700000</td>
</tr>
<tr class="even">
<td align="left">Alexandra</td>
<td align="right">1920</td>
<td align="right">37.000000</td>
</tr>
<tr class="odd">
<td align="left">Alexandra</td>
<td align="right">1930</td>
<td align="right">44.400000</td>
</tr>
<tr class="even">
<td align="left">Alexandra</td>
<td align="right">1940</td>
<td align="right">117.100000</td>
</tr>
</tbody>
</table></div>
</div>
<p>Now just to explain a little more, the reason that this function, the <code><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></code>, is called a pipe is because it 'pipes' the data through to the next function. When you wrote the code previously, the first argument of each function was the dataset you wanted to work on. When you use pipes it will automatically take the data from the previous line of code so you don't need to specify it again.</p>
<div class="info">
<p>
<strong>Read your pipe like a paragraph</strong>
</p>
<p>
When learning to code it can be a useful practice to read your code 'out loud' in full sentences to help you understand what it is doing. You can read the code above as "starting with <code>babynames</code>, create a new variable called <code>decade</code> AND THEN keep only the names Emily, Kathleen, Alexandra and Beverly and that belong to female babies, AND THEN group the dataset by name and decade AND THEN calculate the mean number of babies with each name per decade." Try doing this each time you write a new bit of code and you should find the code becomes much easier to follow
</p>
</div>
<p>Some people find pipes a bit tricky to understand from a conceptual point of view, however, it's well worth learning to use them as when your code starts getting longer they are much more efficient and mean you have to write less code which is always a good thing!</p>
</div>
<div id="dw1-fin" class="section level2" number="4.5">
<h2>
<span class="header-section-number">4.5</span> Finished!<a class="anchor" aria-label="anchor" href="#dw1-fin"><i class="fas fa-link"></i></a>
</h2>
<p>Brilliant! That has been a lot of information but hopefully it has started to give you a sense of some of the approaches to data wrangling and the main functions we will use as we get deeper into the book!</p>
</div>
<div id="ld-test" class="section level2" number="4.6">
<h2>
<span class="header-section-number">4.6</span> Test yourself<a class="anchor" aria-label="anchor" href="#ld-test"><i class="fas fa-link"></i></a>
</h2>
<div id="knowledge-questions-1" class="section level3" number="4.6.1">
<h3>
<span class="header-section-number">4.6.1</span> Knowledge Questions<a class="anchor" aria-label="anchor" href="#knowledge-questions-1"><i class="fas fa-link"></i></a>
</h3>
<ol style="list-style-type: decimal">
<li>Which of the following is not one of the Wickham Six functions?
<div id="radio_XUNFLHDHJW" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_XUNFLHDHJW" value="answer"><span>melt()</span></label><label><input type="radio" autocomplete="off" name="radio_XUNFLHDHJW" value=""><span>arrange()</span></label><label><input type="radio" autocomplete="off" name="radio_XUNFLHDHJW" value=""><span>mutate()</span></label><label><input type="radio" autocomplete="off" name="radio_XUNFLHDHJW" value=""><span>filter()</span></label>
</div>
</li>
<li>Which of the following functions would I use if I wanted to keep only certain columns?
<div id="radio_UJTLVJIFDU" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_UJTLVJIFDU" value="answer"><span>select()</span></label><label><input type="radio" autocomplete="off" name="radio_UJTLVJIFDU" value=""><span>arrange()</span></label><label><input type="radio" autocomplete="off" name="radio_UJTLVJIFDU" value=""><span>mutate()</span></label><label><input type="radio" autocomplete="off" name="radio_UJTLVJIFDU" value=""><span>filter()</span></label>
</div>
</li>
<li>Which of the following functions would I use if I wanted to keep only certain rows?
<div id="radio_LISGIKELDS" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_LISGIKELDS" value=""><span>select()</span></label><label><input type="radio" autocomplete="off" name="radio_LISGIKELDS" value=""><span>arrange()</span></label><label><input type="radio" autocomplete="off" name="radio_LISGIKELDS" value=""><span>mutate()</span></label><label><input type="radio" autocomplete="off" name="radio_LISGIKELDS" value="answer"><span>filter()</span></label>
</div>
</li>
<li>Which of the following functions would I use if I wanted to add a new column of information?
<div id="radio_HKMNQBCFJS" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_HKMNQBCFJS" value=""><span>select()</span></label><label><input type="radio" autocomplete="off" name="radio_HKMNQBCFJS" value=""><span>arrange()</span></label><label><input type="radio" autocomplete="off" name="radio_HKMNQBCFJS" value="answer"><span>mutate()</span></label><label><input type="radio" autocomplete="off" name="radio_HKMNQBCFJS" value=""><span>filter()</span></label>
</div>
</li>
<li>Which boolean expression would I add to a <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> function to keep only Male babies in the original <code>babynames</code> data?
<div id="radio_MFRHYHUXLA" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_MFRHYHUXLA" value=""><span>sex == F</span></label><label><input type="radio" autocomplete="off" name="radio_MFRHYHUXLA" value="answer"><span>sex == M</span></label><label><input type="radio" autocomplete="off" name="radio_MFRHYHUXLA" value=""><span>sex &lt; F</span></label><label><input type="radio" autocomplete="off" name="radio_MFRHYHUXLA" value=""><span>Sex == M</span></label>
</div>
</li>
</ol>
<div class="webex-solution">
<button>
Explain these Answers
</button>
<ol style="list-style-type: decimal">
<li>
<code>melt()</code> is not a function in the Wickham six functions. It is actually a function but not one we tend to use.</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> is the function for keeping and removing columns.</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> is the function for keeping and removing rows.</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> is the function for adding new columns.</li>
<li>Assuming the original data has not been changed, <code>"sex == M"</code> would work and not <code>"Sex == M"</code> as there is no column called Sex with an uppercase S. Remember to be exact.</li>
</ol>
</div>
</div>
<div id="dw1-debugex" class="section level3" number="4.6.2">
<h3>
<span class="header-section-number">4.6.2</span> Debugging exercises<a class="anchor" aria-label="anchor" href="#dw1-debugex"><i class="fas fa-link"></i></a>
</h3>
<ol style="list-style-type: decimal">
<li>Restart the R session (<strong><code>Session &gt;&gt; Restart R</code></strong>). Make sure that the working directory is set to the right folder and then run the below code in your console window:</li>
</ol>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">babynames</span></code></pre></div>
<p>This will produce the error:</p>
<pre><code>Error: object 'babynames' not found</code></pre>
<p>Once you figure out how to fix this error, make a note of it.</p>
<div class="webex-solution">
<button>
Solution
</button>
<p>This is an indication that you have not loaded the <code>babynames</code> package into the library using the <code><a href="https://rdrr.io/r/base/library.html">library()</a></code> function</p>
</div>
<p><br></p>
<ol start="2" style="list-style-type: decimal">
<li>Restart the R session (<strong><code>Session &gt;&gt; Restart R</code></strong>). Make sure that the working directory is set to the right folder and then run the below code in your console window:</li>
</ol>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hadley/babynames">babynames</a></span><span class="op">)</span>

<span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>.data <span class="op">=</span> <span class="va">babynames</span>, mean_n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>This will produce the error:</p>
<pre><code>Error in summarise(.data = babynames, mean_n = mean(n)) : 
  could not find function "summarise"</code></pre>
<p>Once you figure out how to fix this error, make a note of it.</p>
<div class="webex-solution">
<button>
Solution
</button>
<p>What the error is saying is that there is no function called <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code>. You know that function exists though. What you have not done is call load the function into the libary using <code><a href="https://tidyverse.tidyverse.org">library(tidyverse)</a></code></p>
</div>
<p><br></p>
<ol start="3" style="list-style-type: decimal">
<li>Restart the R session (<strong><code>Session &gt;&gt; Restart R</code></strong>). Make sure that the working directory is set to the right folder and then run the below code in your console window:</li>
</ol>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="data-wrangling-1.html#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(babynames)</span>
<span id="cb72-2"><a href="data-wrangling-1.html#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb72-3"><a href="data-wrangling-1.html#cb72-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-4"><a href="data-wrangling-1.html#cb72-4" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">summarise</span>(<span class="at">.data =</span> babynames <span class="at">mean_n =</span> <span class="fu">mean</span>(n))</span></code></pre></div>
<p>This will produce the error:</p>
<pre><code>Error: unexpected symbol in "dat &lt;- summarise(.data = babynames mean_n"
</code></pre>
<p>Once you figure out how to fix this error, make a note of it.</p>
<div class="webex-solution">
<button>
Solution
</button>
<p>This is actually one of the most painful errors you can see as it doesn't really help you solve your issue because it is not quite clear what it means. <strong>unexpected symbol</strong> means effectively that the code is wrong and it is seeing something it did not think it would see. Again not that clear right? What we do when we see this is ask ourselves have we forgotten a comma somewhere or maybe a bracket or a quotation mark! Look for those issues and see if that helps. The error does show you that the error comes between <code>babynames</code> and <code>mean_n</code> it just isn't clear that that is what it means. The issue will be around the last word it mentions basically. The answer here is that there is a comma missing between the data and the arguement; between <code>babynames</code> and <code>mean_n</code>. The line should read:</p>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hadley/babynames">babynames</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>

<span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>.data <span class="op">=</span> <span class="va">babynames</span>, mean_n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Again an incredibly frustrating and time consuming error. Watch out for these. It is why partitioning the code on to new lines after a comma can be really help see errors as such:</p>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hadley/babynames">babynames</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>

<span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>.data <span class="op">=</span> <span class="va">babynames</span>, 
                 mean_n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Such a dastardly error! Well done if you spotted it!!!</p>
</div>
<p><br></p>
</div>
</div>
<div id="words-from-this-chapter-3" class="section level2" number="4.7">
<h2>
<span class="header-section-number">4.7</span> Words from this Chapter<a class="anchor" aria-label="anchor" href="#words-from-this-chapter-3"><i class="fas fa-link"></i></a>
</h2>
<p>Below you will find a list of words that were used in this chapter that might be new to you in case it helps to have somewhere to refer back to what they mean. The links in this table take you to the entry for the words in the <a href="https://psyteachr.github.io/glossary/" target="_blank">PsyTeachR Glossary</a>. Note that the Glossary is written by numerous members of the team and as such may use slightly different terminology from that shown in the chapter.</p>
<div class="inline-table"><table class="table table-sm">
<colgroup>
<col width="53%">
<col width="46%">
</colgroup>
<thead><tr class="header">
<th align="left">term</th>
<th align="left">definition</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><a href="https://psyteachr.github.io/glossary/a.html#assignment-operator" class="glossary" target="_blank">assignment operator</a></td>
<td align="left">The symbol &lt;-, which functions like = and assigns the value on the right to the object on the left</td>
</tr>
<tr class="even">
<td align="left"><a href="https://psyteachr.github.io/glossary/c.html#chunk" class="glossary" target="_blank">chunk</a></td>
<td align="left">A section of code in an R Markdown file</td>
</tr>
<tr class="odd">
<td align="left"><a href="https://psyteachr.github.io/glossary/c.html#console" class="glossary" target="_blank">console</a></td>
<td align="left">The pane in RStudio where you can type in commands and view output messages.</td>
</tr>
<tr class="even">
<td align="left"><a href="https://psyteachr.github.io/glossary/d.html#data-type" class="glossary" target="_blank">data type</a></td>
<td align="left">The kind of data represented by an object.</td>
</tr>
<tr class="odd">
<td align="left"><a href="https://psyteachr.github.io/glossary/d.html#data-wrangling" class="glossary" target="_blank">data wrangling</a></td>
<td align="left">The process of preparing data for visualisation and statistical analysis.</td>
</tr>
<tr class="even">
<td align="left"><a href="https://psyteachr.github.io/glossary/f.html#function" class="glossary" target="_blank">function</a></td>
<td align="left">A named section of code that can be reused.</td>
</tr>
<tr class="odd">
<td align="left"><a href="https://psyteachr.github.io/glossary/o.html#object" class="glossary" target="_blank">object</a></td>
<td align="left">A word that identifies and stores the value of some data for later use.</td>
</tr>
<tr class="even">
<td align="left"><a href="https://psyteachr.github.io/glossary/o.html#outlier" class="glossary" target="_blank">outlier</a></td>
<td align="left">A data point that is extremely distant from most of the other data points</td>
</tr>
<tr class="odd">
<td align="left"><a href="https://psyteachr.github.io/glossary/p.html#package" class="glossary" target="_blank">package</a></td>
<td align="left">A group of R functions.</td>
</tr>
<tr class="even">
<td align="left"><a href="https://psyteachr.github.io/glossary/p.html#pipe" class="glossary" target="_blank">pipe</a></td>
<td align="left">A way to order your code in a more readable format using the symbol %&gt;%</td>
</tr>
<tr class="odd">
<td align="left"><a href="https://psyteachr.github.io/glossary/r.html#reproducible-research" class="glossary" target="_blank">reproducible research</a></td>
<td align="left">Research that documents all of the steps between raw data and results in a way that can be verified.</td>
</tr>
<tr class="even">
<td align="left"><a href="https://psyteachr.github.io/glossary/t.html#tabular-data" class="glossary" target="_blank">tabular data</a></td>
<td align="left">Data in a rectangular table format, where each row has an entry for each column.</td>
</tr>
<tr class="odd">
<td align="left"><a href="https://psyteachr.github.io/glossary/t.html#tibble" class="glossary" target="_blank">tibble</a></td>
<td align="left">A container for tabular data with some different properties to a data frame</td>
</tr>
<tr class="even">
<td align="left"><a href="https://psyteachr.github.io/glossary/v.html#vector" class="glossary" target="_blank">vector</a></td>
<td align="left">A type of data structure that collects values with the same data type, like T/F values, numbers, or strings.</td>
</tr>
</tbody>
</table></div>
<p><strong>End of Chapter</strong></p>
<p>That is end of this chapter. Be sure to look again at anything you were unsure about and make some notes to help develop your own knowledge and skills. It would be good to write yourself some questions about what you are unsure of and see if you can answer them later or speak to someone about them. Good work today!</p>

</div>
</div>
<script>

/* update total correct if #webex-total_correct exists */
update_total_correct = function() {
  console.log("webex: update total_correct");

  if (t = document.getElementById("webex-total_correct")) {
    var correct = document.getElementsByClassName("webex-correct").length;
    var solvemes = document.getElementsByClassName("webex-solveme").length;
    var radiogroups = document.getElementsByClassName("webex-radiogroup").length;
    var selects = document.getElementsByClassName("webex-select").length;
    
    t.innerHTML = correct + " of " + (solvemes + radiogroups + selects) + " correct";
  }
}

/* webex-solution button toggling function */
b_func = function() {
  console.log("webex: toggle hide");
  
  var cl = this.parentElement.classList;
  if (cl.contains('open')) {
    cl.remove("open");
  } else {
    cl.add("open");
  }
}

/* function for checking solveme answers */
solveme_func = function(e) {
  console.log("webex: check solveme");

  var real_answers = JSON.parse(this.dataset.answer);
  var my_answer = this.value;
  var cl = this.classList;
  if (cl.contains("ignorecase")) {
    my_answer = my_answer.toLowerCase();
  }
  if (cl.contains("nospaces")) {
    my_answer = my_answer.replace(/ /g, "")
  }

  if (my_answer == "") {
    cl.remove("webex-correct");
    cl.remove("webex-incorrect");
  } else if (real_answers.includes(my_answer)) {
    cl.add("webex-correct");
    cl.remove("webex-incorrect");
  } else {
    cl.add("webex-incorrect");
    cl.remove("webex-correct");
  }

  // match numeric answers within a specified tolerance
  if(this.dataset.tol > 0){
    var tol = JSON.parse(this.dataset.tol);
    var matches = real_answers.map(x => Math.abs(x - my_answer) < tol)
    if (matches.reduce((a, b) => a + b, 0) > 0) {
      cl.add("webex-correct");
    } else {
      cl.remove("webex-correct");
    }
  }

  // added regex bit
  if (cl.contains("regex")){
    answer_regex = RegExp(real_answers.join("|"))
    if (answer_regex.test(my_answer)) {
      cl.add("webex-correct");
    }
  }

  update_total_correct();
}

/* function for checking select answers */
select_func = function(e) {
  console.log("webex: check select");
  
  var cl = this.classList
  
  /* add style */
  cl.remove("webex-incorrect");
  cl.remove("webex-correct");
  if (this.value == "answer") {
    cl.add("webex-correct");
  } else if (this.value != "blank") {
    cl.add("webex-incorrect");
  }
  
  update_total_correct();
}

/* function for checking radiogroups answers */
radiogroups_func = function(e) {
  console.log("webex: check radiogroups");

  var checked_button = document.querySelector('input[name=' + this.id + ']:checked');
  var cl = checked_button.parentElement.classList;
  var labels = checked_button.parentElement.parentElement.children;
  
  /* get rid of styles */
  for (i = 0; i < labels.length; i++) {
    labels[i].classList.remove("webex-incorrect");
    labels[i].classList.remove("webex-correct");
  }
  
  /* add style */
  if (checked_button.value == "answer") {
    cl.add("webex-correct");
  } else {
    cl.add("webex-incorrect");
  }
  
  update_total_correct();
}

window.onload = function() {
  console.log("onload");
  /* set up solution buttons */
  var buttons = document.getElementsByTagName("button");

  for (var i = 0; i < buttons.length; i++) {
    if (buttons[i].parentElement.classList.contains('webex-solution')) {
      buttons[i].onclick = b_func;
    }
  }

  /* set up webex-solveme inputs */
  var solveme = document.getElementsByClassName("webex-solveme");

  for (var i = 0; i < solveme.length; i++) {
    /* make sure input boxes don't auto-anything */
    solveme[i].setAttribute("autocomplete","off");
    solveme[i].setAttribute("autocorrect", "off");
    solveme[i].setAttribute("autocapitalize", "off");
    solveme[i].setAttribute("spellcheck", "false");
    solveme[i].value = "";

    /* adjust answer for ignorecase or nospaces */
    var cl = solveme[i].classList;
    var real_answer = solveme[i].dataset.answer;
    if (cl.contains("ignorecase")) {
      real_answer = real_answer.toLowerCase();
    }
    if (cl.contains("nospaces")) {
      real_answer = real_answer.replace(/ /g, "");
    }
    solveme[i].dataset.answer = real_answer;

    /* attach checking function */
    solveme[i].onkeyup = solveme_func;
    solveme[i].onchange = solveme_func;
  }
  
  /* set up radiogroups */
  var radiogroups = document.getElementsByClassName("webex-radiogroup");
  for (var i = 0; i < radiogroups.length; i++) {
    radiogroups[i].onchange = radiogroups_func;
  }
  
  /* set up selects */
  var selects = document.getElementsByClassName("webex-select");
  for (var i = 0; i < selects.length; i++) {
    selects[i].onchange = select_func;
  }

  update_total_correct();
}

</script><script>
$( document ).ready(function() {
  var cite = ' ';
  var psyteachr = ' <a href="https://psyteachr.github.io/"><img src="images/logos/psyteachr_logo.png" style="height: 31px; color: white;" alt="psyTeachR: Reproducible Research" /></a>';
  var license = ' <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/" target="blank"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png"></a>';

  $("footer div.row div:eq(1) p").html(
    psyteachr + license + cite
  );
  
  // open rdrr links externally
  $("a[href^='https://rdrr.io']").click(function(){
    window.open(this.href);
    return false;
  });
  
  // visible second sidebar in mobile
  function move_sidebar() {
    var w = window.innerWidth;
    if (w < 992) {
      $("#toc").appendTo($("#main-nav"));
    } else {
      $("#toc").appendTo($("div.sidebar-chapter"));
    }
  }
  move_sidebar();
  window.onresize = move_sidebar;
});
</script><div class="chapter-nav">
<div class="prev"><a href="starting-with-data.html"><span class="header-section-number">3</span> Starting with data</a></div>
<div class="next"><a href="data-wrangling-2.html"><span class="header-section-number">5</span> Data wrangling 2</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#data-wrangling-1"><span class="header-section-number">4</span> Data wrangling 1</a></li>
<li><a class="nav-link" href="#tidyverse"><span class="header-section-number">4.1</span> Tidyverse</a></li>
<li>
<a class="nav-link" href="#intro-to-the-babynames-database"><span class="header-section-number">4.2</span> Intro to the babynames database</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#dw1-a1"><span class="header-section-number">4.2.1</span> Activity 1: Set-up</a></li>
<li><a class="nav-link" href="#dw1-a2"><span class="header-section-number">4.2.2</span> Activity 2: Look at the data</a></li>
<li><a class="nav-link" href="#dw1-a3"><span class="header-section-number">4.2.3</span> Activity 3: Your first plot</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#six-functions-for-wrangling-the-babynames"><span class="header-section-number">4.3</span> Six functions for wrangling the babynames</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#dw1-a4"><span class="header-section-number">4.3.1</span> Activity 4: Selecting variables of interest with select()</a></li>
<li><a class="nav-link" href="#dw1-a5"><span class="header-section-number">4.3.2</span> Activity 5: Arranging the data with arrange()</a></li>
<li><a class="nav-link" href="#dw1-a6"><span class="header-section-number">4.3.3</span> Activity 6: Using filter() to choose observations</a></li>
<li><a class="nav-link" href="#dw1-a7"><span class="header-section-number">4.3.4</span> Activity 7: Creating new variables with mutate()</a></li>
<li><a class="nav-link" href="#dw1-a8"><span class="header-section-number">4.3.5</span> Activity 8: Grouping and summarising</a></li>
</ul>
</li>
<li><a class="nav-link" href="#dw1-a9"><span class="header-section-number">4.4</span> Introducing Pipes</a></li>
<li><a class="nav-link" href="#dw1-fin"><span class="header-section-number">4.5</span> Finished!</a></li>
<li>
<a class="nav-link" href="#ld-test"><span class="header-section-number">4.6</span> Test yourself</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#knowledge-questions-1"><span class="header-section-number">4.6.1</span> Knowledge Questions</a></li>
<li><a class="nav-link" href="#dw1-debugex"><span class="header-section-number">4.6.2</span> Debugging exercises</a></li>
</ul>
</li>
<li><a class="nav-link" href="#words-from-this-chapter-3"><span class="header-section-number">4.7</span> Words from this Chapter</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/PsyTeachR/quant-fun-v2/blob/master/book/04-wrangling-1.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/PsyTeachR/quant-fun-v2/edit/master/book/04-wrangling-1.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Fundamentals of Quantitative Analysis</strong>" was written by Emily Nordmann &amp; Phil McAleer. It was last built on 2023-01-26.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
